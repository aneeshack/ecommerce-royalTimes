<%- include('../layouts/admin/header',{title: editMode ? 'Edit Product' : 'Add Product' }) %>

  <!-- Bootstrap CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <!-- font awsome adding link -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Cropper CSS for image cropping -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" />
  </head>

  <body>
    <div class="container mt-5">
      <h1 class="mb-4">
        <%= editMode ? 'Edit Product' : 'Add Product' %>
        <span id="messageShow" class=" text-danger"></span>
      </h1>
      <% if (typeof successMessage !=='undefined' && successMessage.length> 0) { %>
        <div class="alert alert-success">
          <%= successMessage %>
        </div>
        <% } %>

          <% if (typeof errorMessage !=='undefined' && errorMessage.length> 0) { %>
            <div class="alert alert-danger">
              <ul>
                <% errorMessage.forEach(error=> { %>
                  <li>
                    <%= error %>
                  </li>
                  <% }); %>
              </ul>
            </div>
            <% } %>
              <form
                action="<%= editMode ? `/admin/product/editProduct/${product._id}` : '/admin/product/addProduct' %>  "
                method="post" id="upload-form" enctype="multipart/form-data" >
                <div class="form-group ">
                  <label for="productName">Product Name</label>
                  <input type="text" class="form-control" id="productName" placeholder="Enter product name"
                    name="productName" value="<%= editMode ? product.productName  :'' %>" required >
                    <i class="fa  " aria-hidden="true"></i>
                     <span></span>
                </div>
                <div class="form-group">
                  <label for="productPrice">Product Price</label>
                  <input type="number" class="form-control" id="productPrice" placeholder="Enter product price"
                    name="price" value="<%= editMode ? product.price  :'' %>" required>
                    <i class="fa  " aria-hidden="true"></i>
                    <span></span>
                  </div>
                <div class="form-group">
                  <label for="productStock">Stock</label>
                  <input type="number" class="form-control" id="productStock" placeholder="Enter stock quantity"
                    name="stock" value="<%= editMode ? product.stock : '' %>" required>
                    <i class="fa  " aria-hidden="true"></i>
                    <span></span>
                  </div>
                <div class="form-group">
                  <label for="productWarranty">Warranty (year)</label>
                  <input type="number" class="form-control" id="productWarranty" placeholder="Enter warranty duration"
                    name="warranty" value="<%= editMode ? product.warranty : '' %>" required>
                    <!-- <i class="fa  " aria-hidden="true"></i>
                    <span></span> -->
                    <div id="messageShow"></div>
                  </div>
                <div class="form-group">
                  <label for="productRating">Rating</label>
                  <input type="number" class="form-control" id="productRating" placeholder="Enter product rating"
                    name="rating" value="<%= editMode ? product.rating : '' %>" required>
                    <i class="fa  " aria-hidden="true"></i>
                    <span></span>
                  </div>

                <!-- new -->
                <div class="form-group">
                  <label for="watchType">Watch Type</label>
                  <input type="text" class="form-control" id="watchType" placeholder="Enter product watchType"
                    name="watchType" value="<%= editMode ? product.watchType  :'' %>" required>
                    <i class="fa  " aria-hidden="true"></i>
                    <span></span>
                  </div>
                <div class="form-group">
                  <label for="CaseMaterial">Case Material</label>
                  <input type="text" class="form-control" id="CaseMaterial" placeholder="Enter product CaseMaterial"
                    name="CaseMaterial" value="<%= editMode ? product.CaseMaterial  :'' %>" required>
                    <i class="fa  " aria-hidden="true"></i>
                    <span></span>
                  </div>
                <div class="form-group">
                  <label for="dialColour">Dial Colour</label>
                  <input type="text" class="form-control" id="dialColour" placeholder="Enter product dialColour"
                    name="dialColour" value="<%= editMode ? product.dialColour  :'' %>" required>
                    <i class="fa  " aria-hidden="true"></i>
                    <span></span>
                   </div>
                <div class="form-group">
                  <label for="strapMaterial">Strap Material</label>
                  <input type="text" class="form-control" id="strapMaterial" placeholder="Enter product strapMaterial"
                    name="strapMaterial" value="<%= editMode ? product.strapMaterial  :'' %>" required>
                    <i class="fa  " aria-hidden="true"></i>
                    <span></span>
                  </div>
                <div class="form-group">
                  <label for="ModelNumber">Model Number</label>
                  <input type="number" class="form-control" id="ModelNumber" placeholder="Enter product ModelNumber"
                    name="ModelNumber" value="<%= editMode ? product.ModelNumber  :'' %>" required>
                    <i class="fa  " aria-hidden="true"></i>
                    <span></span>
                  </div>
                <div class="form-group">
                  <label for="productName">Features</label>
                  <input type="text" class="form-control" id="features" placeholder="Enter product features"
                    name="features" value="<%= editMode ? product.features  :'' %>" required>
                    <i class="fa  " aria-hidden="true"></i>
                    <span></span>
                  </div>
                <div class="form-group">
                  <label for="productBrand">Brand</label>
                  <select class="form-control" id="productBrand" name="brand" required>
                    <% brands.forEach(brand=> { %>
                      <option value="<%= brand.name %>">
                        <%= brand.name %>
                      </option>
                      <% }) %>
                  </select>
                </div>
                <div class="form-group">
                  <label for="productCategory">Category</label>
                  <select class="form-control" id="productCategory" name="category" required>
                    <% categories.forEach(category=> { %>
                      <option value="<%= category.name %>">
                        <%= category.name %>
                      </option>
                      <% }) %>
                  </select>
                </div>



                <h2>Select Three Images</h2>
                <input type="file" accept="image/*" name="images" multiple onchange="previewImages(event)">
                <p id="file-count">No files selected</p>
                <span id="image-error" style="color: red;"></span>
                <div id="preview"></div>
                
                <br>
                <br>
                <button type="submit" id="productSubmit" class="btn btn-primary">
                  <%= editMode ? 'Update Product' : 'Add Product' %>
                </button>
              </form>
    </div>

    <style>
      .container .fa{
        position: absolute;
        right: 100px;
        margin-top: -30px;

      }
      .container .form-group.errors input{
        border-color:  #f00;
        border-width:  2px;
      }
      .container .form-group.errors .fa{
        color:  #f00;
      }
      .form-group span{
        display: none;
      }
      .form-group.errors span{
        color: #f00;
        display: block;
      }
      .container .form-group.success .fa{
        color:  #0b0;
      }
      .container .form-group.success input{
        border-color : #0b0;
        border-width: 2px;
      }
      .form-group.success span{
        color: #0b0;
        /* display: block; */
      }
    </style>

 <script>
function validateImages(event) {
    let files = event.target.files;
    let errorMessage = document.getElementById('image-error');
    if (files.length !== 3) {
        errorMessage.textContent = 'Exactly three images are required.';
    } else {
        errorMessage.textContent = ''; // Clear the error message if images are correct
    }
}


 </script>
    <script src="/script/product.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
<!-- 
<script>

  function previewImages(event) {

    let preview = document.getElementById('preview');
    preview.innerHTML = '';

    let files = event.target.files;
    for (let i = 0; i < files.length; i++) {
      let file = files[i];
      let reader = new FileReader()

      reader.onload = function (event) {

        var imageContainer = document.createElement('div');
        imageContainer.style.position = 'relative';
        imageContainer.style.display = 'inline-block';
        
        let img = document.createElement('img');
        img.src = event.target.result;
        img.style.width = '300px';
        img.style.height = 'auto';

        var closeButton = document.createElement('button');
        closeButton.innerHTML = '&times;';
        closeButton.style.position = 'absolute';
        closeButton.style.backgroundColor = 'white';
        closeButton.style.fontSize ='20px';
        closeButton.style.left ='-5px';
        closeButton.style.border = '1px';
        closeButton.style.width = '30px';
        closeButton.style.height = '30px';

        imageContainer.appendChild(img)
        imageContainer.appendChild(closeButton)
        preview.appendChild(imageContainer)

        closeButton.onclick = function () {
          preview.removeChild(imageContainer)
        }
      }
      reader.readAsDataURL(file);
    }
  }

</script> -->

<script>

  let selectedFiles = [];

  function previewImages(event) {
    
    let files = Array.from(event.target.files);
    selectedFiles = selectedFiles.concat(files);

    files.forEach((file, index) => {
      let reader = new FileReader()

      reader.onload = function (event) {
        var imageContainer = document.createElement('div');
        imageContainer.style.position = 'relative';
        imageContainer.style.display = 'inline-block';
        
        let img = document.createElement('img');
        img.src = event.target.result;
        img.style.width = '300px';
        img.style.height = 'auto';

        var closeButton = document.createElement('button');
        closeButton.innerHTML = '&times;';
        closeButton.style.position = 'absolute';
        closeButton.style.backgroundColor = 'white';
        closeButton.style.fontSize ='20px';
        closeButton.style.left ='-5px';
        closeButton.style.border = '1px';
        closeButton.style.width = '30px';
        closeButton.style.height = '30px';
        closeButton.onclick = function () {
          preview.removeChild(imageContainer);
          removeFile(index+selectedFiles.length-files.length)
        }

        imageContainer.appendChild(img)
        imageContainer.appendChild(closeButton)
        document.getElementById('preview').appendChild(imageContainer)

        
      }
      reader.readAsDataURL(file);
    });
  }

  function removeFile(index){
    selectedFiles.splice(index , 1);

    let dataTransfer = new DataTransfer();
    selectedFiles.forEach(file => dataTransfer.items.add(file))

    document.querySelector('input[type ="file"]').files = dataTransfer.files;
    updateFileCount();
  }
  function updateFileCount() {
            let fileCountElement = document.getElementById('file-count');
            if (selectedFiles.length === 0) {
                fileCountElement.textContent = 'No files selected';
                alert(fileCountElement.textContent)
            } else {
                fileCountElement.textContent = selectedFiles.length + ' file(s) selected';
            alert(fileCountElement.textContent)
              }
        }

</script>
    <%- include('../layouts/admin/adminFooter') %>